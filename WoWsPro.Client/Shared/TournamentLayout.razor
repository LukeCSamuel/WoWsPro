@layout MainLayout
@inherits LayoutComponentBase
@inject ITournamentService TournamentService
@implements IDisposable

<div class="tournament-layout">
	<div class="side-nav">
		<div class="nav-container">
			<div class="tournament-icon">
				<NavLink class="home" href="/" Match="NavLinkMatch.All"><span class="fas fa-chevron-left"></span> Home</NavLink>
				@if (Context is Tournament)
				{
					<img src="@Context.Icon" />
				}
			</div>
			<nav>
				@if (Context is Tournament)
				{
					<NavLink href="@($"/tournament/{Context.TournamentId}/info")">About</NavLink>
					<NavLink href="@($"/tournament/{Context.TournamentId}/teams")">Teams</NavLink>
					<NavLink href="@($"/tournament/{Context.TournamentId}/register")">Register</NavLink>
				}
			</nav>
		</div>
		<div class="close">
			<button>
				<span class="fas fa-chevron-left"></span>
				<span class="fas fa-chevron-left"></span>
			</button>
		</div>
	</div>

	<div class="body">
		@Body
	</div>
</div>

@code {
	Tournament Context { get; set; }

	protected override async Task OnInitializedAsync ()
	{
		TournamentService.Current.Updated += OnCurrentTournamentUpdated;
		Context = await TournamentService.Current;
	}

	void OnCurrentTournamentUpdated (object sender, Tournament tournament)
	{
		Context = tournament;
		StateHasChanged();
	}

	public void Dispose ()
	{
		TournamentService.Current.Updated -= OnCurrentTournamentUpdated;
	}
}